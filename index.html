<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>D&D DM Assistant</title>
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<div id="audioPanel">
			<div class="albumTitle">
				<h3 style="display: inline-block;">Finding Joy In Troubled Times</h3>
				<a href="https://bit.ly/1VnuQPZ"><button style="display: inline-block; margin: 0 0 0 8px;"><i class="fa fa-download"></i></button></a>
			</div>
			<button id="playprev" class="playerBtn"><i class="fa fa-arrow-left"></i></button>
			<select id="playlist">
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUQUJhQmVZNWNOa0U">1. Introduction</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUQUJhQmVZNWNOa0U">
					2. Rinpoche
					<audio controls></audio>
					<p></ br>hsd sdfkhj sdfh k</p>
				</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUQUJhQmVZNWNOa0U">3. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUQUJhQmVZNWNOa0U">4. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUQUJhQmVZNWNOa0U">5. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">6. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">7. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">8. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">9. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">10. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">11. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">12. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">13. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">14. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">15. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">16. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">17. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">18. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">19. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">20. Rinpoche</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">21. Paloma</option>
				<option data-mp3="https://docs.google.com/uc?export=download&id=0B2cLBXvhN6QUcVhLcjNsYnJ5b3M">22. Paloma & Rinpoche</option>
			</select>
			<button id="playnext" class="playerBtn"><i class="fa fa-arrow-right"></i></button>
			<div id="playerWrap" class="playerWrap">
				<audio id="audio" controls></audio>
			</div>
		</div>
		<script>
			// globals
			var 
			_player = document.getElementById("audio"),
			_playlist = document.getElementById("playlist"),
			_playprev = document.getElementById("playprev"),
			_playnext = document.getElementById("playnext");
			
			var isPlaying = false;
			
			// functions
			function setIsPlaying( audioEl, isPlaying ) {
			 audioEl.setAttribute('playstate', isPlaying);
			}
			
			function getIsPlaying( audioEl ) {
			return audioEl.getAttribute('playstate');
			}
			
			function playPrev( selectEl ) {
			var prevIdx = selectEl.selectedIndex - 1;
			
			if (prevIdx!==-1){
			 selectEl.selectedIndex = prevIdx;
			 selectionChanged(_playlist);
			 playOption(selectEl.options[selectEl.selectedIndex]);
			}
			}
			
			function nextOptionIdx( selectEl ) {
			var lastIdx = selectEl.options.length - 1;
			var nextIdx = selectEl.selectedIndex + 1;
			
			if (nextIdx>lastIdx) return -1;
			else return nextIdx;
			}
			
			function playNext( selectEl ) {
			var nextIdx = nextOptionIdx( selectEl );
			
			if (nextIdx!==-1){
			 selectEl.selectedIndex = nextIdx;
			 selectionChanged(_playlist);
			 playOption(selectEl.options[selectEl.selectedIndex]);
			}
			}
			
			function playOption(option) {
			_player.src = option.getAttribute("data-mp3");
			
			if (getIsPlaying(_playlist)==="true")
			 _player.play();
			}
			
			function selectionChanged(selectEl) {
			var curId = selectEl.selectedIndex;
			var lastIdx = selectEl.options.length - 1;
			
			_playprev.disabled = (curId === 0);   
			_playnext.disabled = (curId === lastIdx);    
			}
			
			_player.addEventListener("play", function(e) { 
			setIsPlaying(_playlist, true);
			});
			
			_player.addEventListener("pause", function(e) { 
			setIsPlaying(_playlist, false);
			});
			
			_player.addEventListener("ended", function(e) { 
			setIsPlaying(_playlist, true);
			playNext(_playlist);
			});
			
			_playprev.addEventListener("click", function(e) { 
			playPrev(_playlist);
			});
			
			_playnext.addEventListener("click", function(e) { 
			playNext(_playlist);
			});
			
			_playlist.addEventListener("change", function(e) {
			if (e.target && e.target.nodeName === "SELECT") {
			 selectionChanged(_playlist);
			 playOption(e.target.options[e.target.selectedIndex], !getIsPlaying(_player));
			}
			});
			
			selectionChanged(_playlist);
			//Get the first song loaded but paused
			playOption(_playlist.options[_playlist.selectedIndex], true);
		</script>
	</body>
</html>
